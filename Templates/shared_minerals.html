<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minerals Overview</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-5xl mx-auto mt-10 bg-white shadow-lg rounded-lg p-8">
    <h2 class="text-3xl font-bold mb-6 text-center text-indigo-700">Minerals Overview</h2>
<!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mb-6">
              {% for category, message in messages %}
                <div class="flash px-4 py-3 rounded text-white font-medium
                            {% if category == 'success' %} bg-green-500
                            {% elif category == 'info' %} bg-green-500
                            {% elif category == 'error' %} bg-red-500
                            {% else %} bg-gray-500 {% endif %}">
                  {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}        
        

    <!-- Export Form (Investor & Researcher Only) -->
    {% if role in ['investor', 'researcher'] %}
    <form method="post" action="{{ url_for('export_minerals', role=role) }}" class="mb-10 space-y-6" id="export-form">
      
      <!-- Select All Toggle -->
      <div>
        <label class="flex items-center mb-2">
          <input type="checkbox" id="select-all" class="mr-2 accent-indigo-600">
          <span class="text-sm text-gray-700">Select All Minerals</span>
        </label>
      </div>

      <!-- Mineral Selection -->
      <fieldset>
        <legend class="text-lg font-semibold text-gray-800 mb-2">Select Minerals to Export:</legend>
        <div class="grid grid-cols-2 gap-2">
          {% for mineral in minerals %}
          <label class="flex items-center">
            <input type="checkbox" name="mineral_id" value="{{ mineral['MineralID'] }}" class="mr-2 accent-indigo-600">
            {{ mineral['MineralName'] }}
          </label>
          {% endfor %}
        </div>
      </fieldset>

      <!-- Format Selection -->
      <fieldset>
        <legend class="text-lg font-semibold text-gray-800 mb-2">Select Export Format:</legend>
        <label class="inline-flex items-center mr-4">
          <input type="radio" name="format" value="csv" checked class="accent-indigo-600 mr-2">
          CSV
        </label>
        <label class="inline-flex items-center">
          <input type="radio" name="format" value="json" class="accent-indigo-600 mr-2">
          JSON
        </label>
      </fieldset>

      <!-- Submit Button -->
      <div class="text-center">
        <button type="submit"
                class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700 transition">
          Export Selected Minerals
        </button>
      </div>
    </form>
    {% endif %}

    <!-- Minerals Table -->
    <table class="min-w-full bg-white border rounded">
      <thead class="bg-indigo-100 text-indigo-900">
        <tr>
          <th class="py-2 px-4 border-b">ID</th>
          <th class="py-2 px-4 border-b">Name</th>
          <th class="py-2 px-4 border-b">Description</th>
          <th class="py-2 px-4 border-b">Price (USD/tonne)</th>
        </tr>
      </thead>
      <tbody>
        {% for mineral in minerals %}
        <tr class="hover:bg-gray-50">
          <td class="py-2 px-4 border-b">{{ mineral['MineralID'] }}</td>
          <td class="py-2 px-4 border-b">{{ mineral['MineralName'] }}</td>
          <td class="py-2 px-4 border-b">{{ mineral['Description'] }}</td>
          <td class="py-2 px-4 border-b">${{ "%.2f"|format(mineral['MarketPriceUSD_per_tonne']) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Back Button -->
    <a href="{{ url_for('home') }}"
       class="block mt-8 bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition text-center">
      ‚Üê Back to Dashboard
    </a>
  </div>

  <!-- JS: Select All + Validation -->
  <script>
    document.getElementById('select-all').addEventListener('change', function(e) {
      document.querySelectorAll('input[name="mineral_id"]').forEach(cb => cb.checked = e.target.checked);
    });

    document.getElementById('export-form').addEventListener('submit', function(e) {
      const checked = document.querySelectorAll('input[name="mineral_id"]:checked');
      if (checked.length === 0) {
        e.preventDefault();
        alert("Please select at least one mineral to export.");
      }
    });
  </script>
</body>
</html>





